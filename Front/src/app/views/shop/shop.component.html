<div class="shop-layout">
  <!-- üß≠ Sidebar de categor√≠as -->
  <aside class="shop-sidebar">
    <h3>Categor√≠as</h3>
    <hr class="gold-divider" />

    <ul class="category-list">
      <!-- Ver todas -->
      <li>
        <a (click)="filterByCategory(null)">Ver todas</a>
      </li>

      <!-- Loop de categor√≠as principales -->
      <li
        *ngFor="let cat of availableCategories"
        class="category-block"
        [class.expanded]="expandedCategories[cat._id!]"
      >
        <!-- Encabezado de categor√≠a con toggle -->
        <div class="category-toggle" (click)="onCategoryClick(cat._id!)">
          <span>{{ cat.name }}</span>
          <span class="toggle-icon">
            {{ expandedCategories[cat._id!] ? "‚ñº" : "‚ñ∂" }}
          </span>
        </div>

        <!-- Subcategor√≠as desplegables -->
        <ul *ngIf="expandedCategories[cat._id!]" class="subcategory-list">
          <li
            *ngFor="let sub of subcategoriesMap[cat._id!]"
            [class.active]="sub._id === selectedSubcategoryId"
          >
            <a (click)="filterBySubcategory(sub._id!)">
              {{ sub.name }}
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </aside>

  <!-- üõçÔ∏è Contenido principal -->
  <section class="shop-main">
    <h2>Nuestros Productos</h2>
    <hr class="gold-divider" />

    <div class="category-select-wrapper">
      <label for="categorySelect">Categor√≠as</label>
      <select #categorySelect (change)="filterByCategory(categorySelect.value)">
        <option value="">Ver todas</option>
        <option
          *ngFor="let cat of availableCategories"
          [value]="cat._id"
          [selected]="selectedCategoryId === cat._id"
        >
          {{ cat.name }}
        </option>
      </select>
    </div>
    <div class="product-grid">
      <!-- Productos est√°ndar (no portfolio) -->

      <app-cards
      
        *ngFor="let product of paginatedProducts"
        [product]="product"
        class="product-card"
      ></app-cards>

      <div
        class="image-modal"
        *ngIf="selectedImageUrl"
        (click)="closeImageModal()"
      >
        <img [src]="selectedImageUrl" alt="Imagen ampliada" />
      </div>
    </div>
    <div class="pagination-controls" *ngIf="filteredProducts.length > pageSize">
      <div class="pagination-buttons">
        <button
          (click)="goToPage(currentPage - 1)"
          [disabled]="currentPage === 1"
        >
          ‚Üê Anterior
        </button>

        <span> {{ currentPage }} de {{ totalPages }}</span>

        <button
          (click)="goToPage(currentPage + 1)"
          [disabled]="currentPage >= totalPages"
        >
          Siguiente ‚Üí
        </button>
      </div>

      <div>
        <p class="product-count">
          Mostrando {{ paginatedProducts.length }} de
          {{ filteredProducts.length }} productos
        </p>
      </div>
    </div>

    <!-- üß≠ Fallback visual -->
    <p *ngIf="filteredProducts.length === 0" class="no-products">
      üïµÔ∏è No se encontraron productos para la categor√≠a seleccionada.
    </p>
  </section>
</div>
