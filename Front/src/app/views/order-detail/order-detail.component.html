<div class="container mt-4">
  <div class="card-gold-wrapper p-4 shadow-sm">
    <h4 class="text-gold mb-4">Resumen de tu compra</h4>

    <!-- üßæ Tabla de productos -->
    <table class="table table-bordered table-sm table-striped">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Cantidad</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of items">
          <td>{{ item.productId.name }}</td>
          <td>{{ item.quantity }}</td>
          <td>${{ item.productId.price * item.quantity }}</td>
        </tr>
      </tbody>
    </table>

    <div class="mb-3">
      <strong>Total:</strong> <span class="text-gold">${{ total }}</span>
      <p class="descuento-info" *ngIf="selectedPayment === 'Transferencia'">
         Total con descuento: {{ total * 0.8 | currency : "ARS" }}
      </p>
    </div>

    <!-- üìç Selector de direcciones -->
    <div class="mb-4">
      <label class="form-label">Direcci√≥n de env√≠o</label>

      <select class="form-select" [(ngModel)]="selectedAddressId">
        <option *ngFor="let dir of addressList" [value]="dir._id">
          {{ dir.street }} {{ dir.number }}, {{ dir.city }} {{ dir.zipCode }}
        </option>
      </select>

      <button
        class="btn btn-outline-gold mt-2"
        type="button"
        (click)="mostrarFormulario = true"
      >
        ‚ûï Agregar nueva direcci√≥n
      </button>
    </div>

    <!-- üè† Formulario para nueva direcci√≥n -->
    <div *ngIf="mostrarFormulario" class="card-new-address p-3 mb-4">
      <h5 class="text-gold mb-3">Nueva direcci√≥n</h5>

      <form [formGroup]="addressForm" (ngSubmit)="onCreateAddress()">
        <div class="row">
          <div class="col-md-6 mb-3">
            <input
              class="form-control"
              formControlName="street"
              placeholder="Calle"
            />
          </div>
          <div class="col-md-3 mb-3">
            <input
              class="form-control"
              formControlName="number"
              placeholder="N√∫mero"
            />
          </div>
          <div class="col-md-3 mb-3">
            <input
              class="form-control"
              formControlName="zipCode"
              placeholder="C√≥digo Postal"
            />
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <input
              class="form-control"
              formControlName="city"
              placeholder="Ciudad"
            />
          </div>
          <div class="col-md-6 mb-3">
            <input
              class="form-control"
              formControlName="province"
              placeholder="Provincia"
            />
          </div>
        </div>

        <div class="mb-3">
          <input
            class="form-control"
            formControlName="country"
            placeholder="Pa√≠s"
          />
        </div>

        <button class="btn btn-gold" type="submit">Guardar direcci√≥n</button>
      </form>
    </div>

    <br />
    <hr />
    <!-- üí¨ Hint emocional interior -->

    <div class="d-flex flex-column align-items-center text-center mt-2 gap-2">
      <div>
        <p>
          ¬øEst√°s en el interior del pa√≠s? Escribinos y vemos juntos la mejor
          forma de hacerte llegar tu pedido. En <strong>Distinzione</strong>,
          cada env√≠o tiene su cuidado üíé
        </p>
      </div>
      <div>
        <a
          class="btn btn-success d-flex align-items-center gap-2 px-3 py-2 rounded-pill"
          (click)="abrirWhatsApp()"
        >
          <i class="fab fa-whatsapp"></i> Consultar por WhatsApp
        </a>
      </div>
    </div>

    <hr />

    <!-- ‚úÖ Checkbox C√≥rdoba capital -->
    <div
      class="form-check d-flex flex-column align-items-center text-center mt-2"
    >
      <div>
        <label class="form-check-label" for="cordobaCapitalCheck">
          Vivo dentro de C√≥rdoba capital y quiero coordinar entrega
          personalizada üöö
        </label>
      </div>
      <div>
        <input class="check-imput" type="checkbox" id="cordobaCapitalCheck" />
      </div>
    </div>

    <br />
    <hr />

    <!-- üí≥ M√©todo de pago -->
    <div class="mb-3">
      <label for="pago">M√©todo de pago</label>
      <select class="form-select" [(ngModel)]="selectedPayment">
        <option value="" disabled selected>Eleg√≠ una opci√≥n</option>
        <option value="MercadoPago">MercadoPago</option>
        <option value="Transferencia">Transferencia</option>
      </select>
    </div>

    <div class="transferencia-info" *ngIf="selectedPayment === 'Transferencia'">
      <p>
        <strong>Datos de cuenta para transferencia:</strong><br />
        <strong>Banco:</strong> Banco Ejemplo<br />
        <strong>N√∫mero de cuenta:</strong> 123456789<br />
        <strong>CBU:</strong> 0001234500006789012345<br />
        <strong>Alias:</strong> brailo<br />
        <strong>Titular:</strong> Nombre del Titular<br /><br />
        Recuerda incluir tu nombre en la referencia de la transferencia.<br />
        Una vez realizada la transferencia, env√≠anos el comprobante a nuestro
        correo electr√≥nico para confirmar tu compra.
      </p>
    </div>

    <!-- üìù Notas -->
    <div class="mb-3">
      <label>Notas (opcional)</label>
      <textarea class="form-control" [(ngModel)]="notes" rows="3"></textarea>
    </div>

    <!-- üõí Confirmar compra -->
    <button class="btn btn-gold w-100" (click)="confirmarOrden()">
      Finalizar compra
    </button>
  </div>
</div>
